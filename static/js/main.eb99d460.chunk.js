(this.webpackJsonppublish=this.webpackJsonppublish||[]).push([[0],{109:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(0),r=n.n(a),s=n(13),i=n(15);function o(e,t){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(r.a.mark((function e(t,n){var a,i,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p(t),e.next=3,Promise.all([u(a,n),u(t,n)]);case 3:return i=e.sent,o=Object(s.a)(i,2),c=o[0],l=o[1],e.abrupt("return",{registryAddress:c,repoAddress:l});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e,t){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.resolveName(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!e.t0.message.includes("not found")){e.next=12;break}return e.abrupt("return",null);case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function p(e){return e.split(".").slice(1).join(".")}},241:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n(0),r=n.n(a),s=n(15),i=n(24),o=n(242),c=n(63),u=n(109);function l(e,t){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(r.a.mark((function t(n,a){var s,l,p,d,f,m,b,y,v,h,g,w,E,x,j;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=n.dnpName,l=n.version,p=n.manifestHash,d=n.developerAddress,s){t.next=3;break}throw Error("dnpName must be defined");case 3:if(l){t.next=5;break}throw Error("version must be defined");case 5:if(p){t.next=7;break}throw Error("manifestHash must be defined");case 7:return f=a.getSigner(),t.next=10,Object(u.a)(s,a);case 10:if(m=t.sent,b=m.registryAddress,y=m.repoAddress,v="0x"+e.from(p,"utf8").toString("hex"),h="0x0000000000000000000000000000000000000000",g=s.split(".")[0],!y){t.next=23;break}return E=new i.ethers.Contract(y,c.abi,f),t.next=20,E.populateTransaction.newVersion(l.split("."),h,v);case 20:w=t.sent,t.next=31;break;case 23:if(d){t.next=25;break}throw Error("developerAddress must be defined for new repos");case 25:if(b){t.next=27;break}throw Error("No registry found for ".concat(s));case 27:return x=new i.ethers.Contract(b,o.abi,f),t.next=30,x.populateTransaction.newRepoWithVersion(g,d,l.split("."),h,v);case 30:w=t.sent;case 31:return t.next=33,f.sendTransaction(w);case 33:return j=t.sent,t.abrupt("return",j.hash);case 35:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}).call(this,n(12).Buffer)},242:function(e){e.exports=JSON.parse('{"contract_name":"registry","address":"0x266bfdb2124a68beb6769dc887bd655f78778923","deployBlock":5254891,"abi":[{"constant":true,"inputs":[],"name":"REPO_APP_NAME","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"APM_APP_NAME","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ENS_SUB_APP_NAME","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"registrar","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_dev","type":"address"},{"name":"_initialSemanticVersion","type":"uint16[3]"},{"name":"_contractAddress","type":"address"},{"name":"_contentURI","type":"bytes"}],"name":"newRepoWithVersion","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"CREATE_REPO_ROLE","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EVMSCRIPT_REGISTRY_APP_ID","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"appId","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getInitializationBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EVMSCRIPT_REGISTRY_APP","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_sender","type":"address"},{"name":"_role","type":"bytes32"},{"name":"params","type":"uint256[]"}],"name":"canPerform","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_dev","type":"address"}],"name":"newRepo","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_registrar","type":"address"}],"name":"initialize","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_kernel","type":"address"},{"name":"_appId","type":"bytes32"},{"name":"_initializePayload","type":"bytes"}],"name":"newAppProxyPinned","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"kernel","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_kernel","type":"address"},{"name":"_appId","type":"bytes32"}],"name":"newAppProxy","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_kernel","type":"address"},{"name":"_appId","type":"bytes32"},{"name":"_initializePayload","type":"bytes"}],"name":"newAppProxy","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_script","type":"bytes"}],"name":"getExecutor","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_kernel","type":"address"},{"name":"_appId","type":"bytes32"}],"name":"newAppProxyPinned","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"bytes32"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"repo","type":"address"}],"name":"NewRepo","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"proxy","type":"address"}],"name":"NewAppProxy","type":"event"}]}')},244:function(e,t){e.exports="data:image/png;base64,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"},250:function(e,t,n){e.exports=n(725)},345:function(e,t,n){},458:function(e,t){},620:function(e,t){},63:function(e){e.exports=JSON.parse('{"contract_name":"repository","address":"dynamic","abi":[{"constant":true,"inputs":[{"name":"_semanticVersion","type":"uint16[3]"}],"name":"getBySemanticVersion","outputs":[{"name":"semanticVersion","type":"uint16[3]"},{"name":"contractAddress","type":"address"},{"name":"contentURI","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EVMSCRIPT_REGISTRY_APP_ID","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newSemanticVersion","type":"uint16[3]"},{"name":"_contractAddress","type":"address"},{"name":"_contentURI","type":"bytes"}],"name":"newVersion","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_versionId","type":"uint256"}],"name":"getByVersionId","outputs":[{"name":"semanticVersion","type":"uint16[3]"},{"name":"contractAddress","type":"address"},{"name":"contentURI","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"appId","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getInitializationBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_contractAddress","type":"address"}],"name":"getLatestForContractAddress","outputs":[{"name":"semanticVersion","type":"uint16[3]"},{"name":"contractAddress","type":"address"},{"name":"contentURI","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EVMSCRIPT_REGISTRY_APP","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_sender","type":"address"},{"name":"_role","type":"bytes32"},{"name":"params","type":"uint256[]"}],"name":"canPerform","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_oldVersion","type":"uint16[3]"},{"name":"_newVersion","type":"uint16[3]"}],"name":"isValidBump","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"CREATE_VERSION_ROLE","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getLatest","outputs":[{"name":"semanticVersion","type":"uint16[3]"},{"name":"contractAddress","type":"address"},{"name":"contentURI","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getVersionsCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"kernel","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_script","type":"bytes"}],"name":"getExecutor","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"versionId","type":"uint256"},{"indexed":false,"name":"semanticVersion","type":"uint16[3]"}],"name":"NewVersion","type":"event"}]}')},720:function(e,t,n){},721:function(e,t,n){},722:function(e,t,n){},723:function(e,t,n){},724:function(e,t,n){},725:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(240),i=n.n(s),o=n(0),c=n.n(o),u=n(15),l=n(72),p=n(13),d=n(24),f=n(111),m=n.n(f),b=n(149),y=n(108),v=n.n(y),h=function(e){var t=e.title,n=e.subtitle,a=e.children;return a?r.a.createElement("div",{className:"section-title"},a):n?r.a.createElement("div",{className:"section-title"},r.a.createElement("span",{className:"pre-title"},t," "),n):r.a.createElement("div",{className:"section-title"},t)},g=function(e){var t=e.children,n=e.className;return r.a.createElement("div",{className:"section-subtitle ".concat(n||"")},t)},w=n(105),E=n(248),x=n(150);function j(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){if("string"===typeof t&&e.push(t),"object"===typeof t)for(var n=0,a=Object.entries(t||{});n<a.length;n++){var r=Object(p.a)(a[n],2),s=r[0];r[1]&&e.push(s)}return e}),[]).join(" ")}var O={boxShadow:"1px 1px 15px 0 rgba(0, 0, 0, 0.07)"},k=function(e){var t=e.children,n=e.className,a=void 0===n?"":n,s=e.shadow,i=e.spacing,o=e.divider,c=e.noscroll,u=Object(E.a)(e,["children","className","shadow","spacing","divider","noscroll"]);return r.a.createElement(x.a,{style:Object(l.a)({overflowX:c?"visible":"auto"},s?O:{})},r.a.createElement(x.a.Body,Object.assign({className:j(Object(w.a)({spacing:i,divider:o,noscroll:c},a,a))},u),t))};n(345);function S(e){var t=function(e){return e instanceof Error||"object"===typeof e&&e.message?{message:e.message,detail:e.stack}:"string"===typeof e?{message:e}:{message:JSON.stringify(e),detail:""}}(e.error),n=t.message,a=t.detail;return r.a.createElement("div",{className:"errorView"},r.a.createElement("details",null,r.a.createElement("summary",null,n.split("\n")[0]),r.a.createElement("pre",null,a)))}var A=n(249);function N(e){var t=e.steps,n=Object(a.useState)(0),s=Object(p.a)(n,2),i=s[0],o=s[1];return Object(a.useEffect)((function(){var e=setInterval((function(){return o((function(e){return e+1}))}),3e3);return function(){return clearInterval(e)}}),[]),r.a.createElement("div",{className:"loadingView"},t&&r.a.createElement("div",{className:"steps text-muted"},t[i]||t[t.length-1],"..."),r.a.createElement(A.a,{animated:!0,now:100}))}function P(e){return null!==e&&void 0!==e}var M=n(241),V=n(63);function I(e,t,n){return R.apply(this,arguments)}function R(){return(R=Object(u.a)(c.a.mark((function e(t,n,a){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.ethers.Contract(t,V.abi,a),e.prev=1,e.next=4,r.canPerform(n,"0x0000000000000000000000000000000000000000000000000000000000000001",[]);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error calling canPerform(".concat(n,"): ").concat(e.t0.message),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function L(){return(L=Object(u.a)(c.a.mark((function e(t,n){var a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ethers.Contract(t,V.abi,n),e.prev=1,e.next=4,a.getLatest();case 4:return r=e.sent,e.abrupt("return",r.semanticVersion.join("."));case 8:throw e.prev=8,e.t0=e.catch(1),e.t0.message="Error getting latest version of ".concat(t,": ").concat(e.t0.message),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function C(){return(C=Object(u.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(n).concat(t,"/").concat("dappnode_package.json")).then((function(e){return e.json()}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.next=10,fetch("".concat(n).concat(t)).then((function(e){return e.json()}));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var D=n(109),T=n(74),_=["patch","minor","major"];function B(e,t){var n,a=Object(T.a)(_);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(v.a.inc(e,r)===t)return!0}}catch(s){a.e(s)}finally{a.f()}return!1}var z=n(243),U=n.n(z);function X(e){return e.includes("ipfs/")&&(e=e.split("ipfs/")[1]),e}function q(e){return!(!e||"string"!==typeof e)&&((e=X(e)).replace("/",""),function(e){return U.a.cid(e)}(e))}function J(e){return e.includes(".")}var F={rel:"noopener noreferrer",target:"_blank"};function G(e){return e.trim().split("\n").map((function(e){return e.trim()})).filter((function(e){return e}))}var H=n(244),Z=n.n(H),W=n(247),K=n(245),Y=n(112),Q=n(103),$=n(104),ee=n(53),te=n(246),ne=n.n(te);function ae(e,t){return re.apply(this,arguments)}function re(){return(re=Object(u.a)(c.a.mark((function e(t,n){var a,r,s,i,o,u,l,p,f,m,b,y,v,h,g,w,E,x,j,O,k,S,A,N,P,M;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length<1)){e.next=2;break}throw Error("ipfsApiUrls is empty");case 2:return a=n.map((function(e){return Object(Y.create)({url:e})})),r=Object(K.a)(a),s=r[0],i=r.slice(1),o=Y.CID.parse(X(t)),e.next=7,s.dag.get(o);case 7:if(u=e.sent,!oe(u).find((function(e){return"signature.json"===e}))){e.next=11;break}throw Error("Release is already signed");case 11:return l=ie(u),f=se(l,p={version:0,base:"base58btc"}),m=new d.ethers.providers.Web3Provider(window.ethereum),b=m.getSigner(),e.next=18,b.signMessage(f);case 18:return y=e.sent,v={version:1,cid:p,signature_protocol:"ECDSA_256",signature:y},h=JSON.stringify(v,null,2),e.next=23,s.add(h);case 23:g=e.sent,w=Object(T.a)(i),e.prev=25,w.s();case 27:if((E=w.n()).done){e.next=33;break}return x=E.value,e.next=31,x.add(h);case 31:e.next=27;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(25),w.e(e.t0);case 38:return e.prev=38,w.f(),e.finish(38);case 41:return u.value.Links.push({Hash:g.cid,Name:"signature.json",Tsize:g.size}),u.value.Links=ne()(u.value.Links,["Name","Bytes"]),console.log("releaseRootDag",u),j={storeCodec:"dag-pb",hashAlg:"sha2-256"},e.next=47,s.dag.put(u.value,j);case 47:O=e.sent,k=Object(T.a)(i),e.prev=49,k.s();case 51:if((S=k.n()).done){e.next=57;break}return A=S.value,e.next=55,A.dag.put(u.value,j);case 55:e.next=51;break;case 57:e.next=62;break;case 59:e.prev=59,e.t1=e.catch(49),k.e(e.t1);case 62:return e.prev=62,k.f(),e.finish(62);case 65:return e.next=67,s.dag.get(O);case 67:if(N=e.sent,P=JSON.stringify(oe(N).sort()),M=JSON.stringify([].concat(Object(W.a)(l.map((function(e){return e.name}))),["signature.json"]).sort()),P===M){e.next=72;break}throw Error("Wrong files in new release: ".concat(P));case 72:return console.log("newReleaseCid",O),e.abrupt("return",O.toV0().toString());case 74:case"end":return e.stop()}}),e,null,[[25,35,38,41],[49,59,62,65]])})))).apply(this,arguments)}function se(e,t){return e.filter((function(e){return"signature.json"!==e.name})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){var n=function(e,t){switch(t){case"base58btc":return e.toString(Q.base58btc);case"base32":return e.toString($.base32);case"base64":return e.toString(ee.base64);case"base64url":return e.toString(ee.base64url);default:throw Error("Unknown CID base ".concat(t))}}(function(e,t){switch(t){case 0:return e.toV0();case 1:return e.toV1();default:throw Error("Unknown CID version ".concat(t))}}(e.cid,t.version),t.base);return"".concat(e.name," ").concat(n)})).join("\n")}function ie(e){return e.value.Links.map((function(e){return{cid:Y.CID.parse(X(e.Hash.toString())),name:e.Name}}))}function oe(e){return e.value.Links.map((function(e){return e.Name}))}function ce(){return(ce=Object(u.a)(c.a.mark((function e(t,n){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=X(t),e.next=3,fetch("".concat(n,"/ipfs/").concat(t,"/").concat("signature.json"));case 3:if((a=e.sent).ok){e.next=6;break}throw Error("Error ".concat(a.statusText));case 6:return e.next=8,a.text();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=m()((function(e,t){return C.apply(this,arguments)}),{promise:!0}),le=m()(D.a,{promise:!0}),pe=m()((function(e,t){return L.apply(this,arguments)}),{promise:!0}),de=function(e){var t=e.success;return e.error?"is-invalid":t?"is-valid":""};function fe(){var e=Object(a.useState)(!1),t=Object(p.a)(e,2),n=t[0],s=t[1],i=Object(a.useState)(function(){var e;return null!==(e=localStorage.getItem("ipfs-api-urls"))&&void 0!==e?e:""}()),o=Object(p.a)(i,2),f=o[0],m=o[1],y=Object(a.useState)(""),w=Object(p.a)(y,2),E=w[0],x=w[1],j=Object(a.useState)(""),O=Object(p.a)(j,2),A=O[0],V=O[1],R=Object(a.useState)(""),L=Object(p.a)(R,2),C=L[0],D=L[1],T=Object(a.useState)(""),_=Object(p.a)(T,2),z=_[0],U=_[1],X=Object(a.useState)(),H=Object(p.a)(X,2),W=H[0],K=H[1],Y=Object(a.useState)(null),Q=Object(p.a)(Y,2),$=Q[0],ee=Q[1],te=Object(a.useState)(),ne=Object(p.a)(te,2),re=ne[0],se=ne[1],ie=Object(a.useState)(),oe=Object(p.a)(ie,2),fe=oe[0],me=oe[1],be=Object(a.useState)({}),ye=Object(p.a)(be,2),ve=ye[0],he=ye[1],ge=Object(a.useState)({}),we=Object(p.a)(ge,2),Ee=we[0],xe=we[1],je=Object(a.useState)({}),Oe=Object(p.a)(je,2),ke=Oe[0],Se=Oe[1],Ae=ve.result;Object(a.useEffect)((function(){return function(e){localStorage.setItem("ipfs-api-urls",e)}(f)}),[f]),Object(a.useEffect)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("?")&&(e=e.slice(1)),e.split("&").reduce((function(e,t){var n=t.split("="),a=Object(p.a)(n,2),r=a[0],s=a[1];return e[r]=decodeURIComponent(s),e}),{})}(window.location.search);console.log("URL params",e),e.r&&x(e.r),e.v&&V(e.v),e.d&&D(e.d),e.h&&U(e.h)}),[]),Object(a.useEffect)((function(){var e=window.ethereum;e&&e.on("accountsChanged",(function(e){console.log("new user account",e[0])}))}),[]);var Ne=Object(a.useMemo)((function(){return Object(b.debounce)((function(e){ue(e,"https://cloudflare-ipfs.com").then((function(t){return K(Object(l.a)(Object(l.a)({},t),{},{hash:e}))})).catch((function(t){return console.error("Error fetching manifest ".concat(e),t)})),function(e,t){return ce.apply(this,arguments)}(e,"https://cloudflare-ipfs.com").then((function(){return ee(!0)})).catch((function(t){console.error("Error fetching release ".concat(e),t),ee(!1)}))}),500)}),[]),Pe=Object(a.useMemo)((function(){return Object(b.debounce)((function(e,t){console.log("ON NEW DNP",e),le(e,t).then(se).catch((function(t){return console.error("Error resolving dnpName ".concat(e),t)})),pe(e,t).then(me).catch((function(t){return console.error("Error get latest ver ".concat(e),t)}))}),500)}),[]);function Me(){return(Me=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,he({loading:!0}),!window.ethereum){e.next=8;break}return e.next=5,window.ethereum.enable();case 5:he({result:new d.ethers.providers.Web3Provider(window.ethereum)}),e.next=13;break;case 8:if(!window.web3){e.next=12;break}he({result:new d.ethers.providers.Web3Provider(window.web3.currentProvider)}),e.next=13;break;case 12:throw Error("Non-Ethereum browser detected. Please, install MetaMask");case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),he({error:e.t0});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function Ve(){return(Ve=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,xe({loading:!0}),e.next=4,ae(z,G(f));case 4:t=e.sent,xe({result:t}),U("/ipfs/".concat(t)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),xe({error:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Ie(){return(Ie=Object(u.a)(c.a.mark((function e(){var t,n,a,r,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E){e.next=3;break}throw Error("Must provide a dnpName");case 3:if(A){e.next=5;break}throw Error("Must provide a version");case 5:if(z){e.next=7;break}throw Error("Must provide a manifestHash");case 7:if(Se({loading:!0}),Ae){e.next=10;break}throw Error("Must connect to Metamask first");case 10:return e.next=12,Ae.getNetwork();case 12:if(!(t=e.sent)||"1"===String(t.chainId)){e.next=15;break}throw Error("Transactions must be published on Ethereum Mainnet");case 15:return e.next=17,Ae.listAccounts();case 17:if(n=e.sent,!(a=n[0])){e.next=30;break}return e.next=22,le(E,Ae);case 22:if(r=e.sent,!(s=r.repoAddress)){e.next=30;break}return e.next=27,I(s,a,Ae);case 27:if(e.sent){e.next=30;break}throw Error("Selected address ".concat(a," is not allowed to publish"));case 30:return e.next=32,Object(M.a)({dnpName:E,version:A,manifestHash:z,developerAddress:C},Ae);case 32:i=e.sent,Se({result:i}),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(0),console.error(e.t0),Se({error:e.t0});case 40:case"end":return e.stop()}}),e,null,[[0,36]])})))).apply(this,arguments)}Object(a.useEffect)((function(){z&&Ne(z)}),[z,Ne]),Object(a.useEffect)((function(){E&&J(E)&&Ae&&Pe(E,Ae)}),[E,Ae,Pe]);var Re=[{id:"dnpName",name:"DAppNode Package name",placeholder:"full ENS name",help:"ENS name of the DAppNode Package to update, i.e. timeapp.public.dappnode.eth",value:E,onValueChange:x,validations:[E?J(E)?{isValid:!0,message:"Valid ENS domain"}:{isValid:!1,message:"Invalid ENS domain"}:null,E&&re?re.registryAddress?re.repoAddress?{isValid:!0,message:"Repo already deployed at: ".concat(re.repoAddress)}:{isValid:!0,message:"New repo to be deployed for ".concat(E)}:{isValid:!1,message:"No valid registry found for ".concat(E)}:null]},{id:"developerAddress",name:"Developer address",placeholder:"Ethereum address",help:"Developer's Ethereum address that will control this repo",value:C,onValueChange:D,validations:[C?d.ethers.utils.isAddress(C)?{isValid:!0,message:"Valid address"}:{isValid:!1,message:"Must be a valid ethereum address"}:null]},{id:"version",name:"Next version",placeholder:"Semantic version",help:"Semantic version about to be published, i.e. 0.1.7",value:A,onValueChange:V,validations:[A?v.a.valid(A)?{isValid:!0,message:"Valid semver"}:{isValid:!1,message:"Invalid semver"}:null,A&&fe?B(fe,A)?{isValid:!0,message:"Valid bump from ".concat(fe)}:{isValid:!1,message:"Next version is not a valid bump"}:null]},{id:"releaseIpfsHash",name:"Release hash",placeholder:"IPFS multihash",help:"IPFS hash of the release. Must be in the format /ipfs/[multihash], i.e. /ipfs/QmVeaz5kR55nAiGjYpXpUAJpWvf6net4MbGFNjBfMTS8xS",value:z,onValueChange:U,validations:[z?q(z)?{isValid:!0,message:"Valid ipfs hash"}:{isValid:!1,message:"Invalid ipfs hash"}:null,W&&z&&z===W.hash&&W.name&&W.version?W.name===E&&W.version===A?{isValid:!0,message:"Manifest successfully verified"}:{isValid:!1,message:"Manifest verification failed. This manifest is for ".concat(W.name," @ ").concat(W.version)}:null,!0===$?{isValid:!0,message:"Release is signed"}:!1===$?{isValid:!1,message:"Release not signed"}:null]}];return r.a.createElement("div",{className:"app"},r.a.createElement(h,{title:"SDK",subtitle:"Publish"}),r.a.createElement("div",{className:"mt-3 text-muted"},r.a.createElement("p",null,"This tool is part of the DAppNode Software Development Kit (dappnodesdk) and allows to sign DAppNode package release transactions with Metamask."),!window.location.search&&r.a.createElement("div",{className:"alert alert-secondary",role:"alert",style:{backgroundColor:"#f1f1f3"}},"To generate a pre-filled URL with the parameters to publish a release transaction install"," ",r.a.createElement("a",Object.assign({href:"https://github.com/dappnode/DAppNodeSDK"},F),r.a.createElement("code",null,"@dappnode/dappnodesdk")))),r.a.createElement(g,null,"Transaction details"),r.a.createElement(k,null,r.a.createElement("div",{className:"publish-grid"},Re.map((function(e){var t=(e.validations||[]).filter(P),n=t.filter((function(e){return e&&e.isValid})),a=t.filter((function(e){return e&&!e.isValid}));return r.a.createElement(r.a.Fragment,{key:e.name},r.a.createElement("div",{className:"field-name"},e.name),r.a.createElement("div",null,r.a.createElement("input",{className:"form-control ".concat(de({error:a.length>0,success:n.length>0})),placeholder:e.placeholder,value:e.value,onChange:function(t){return e.onValueChange(t.target.value)}}),n.map((function(e,t){return r.a.createElement("div",{key:t,className:"valid-feedback"},r.a.createElement("div",null,e.message))})),a.map((function(e,t){return r.a.createElement("div",{key:t,className:"invalid-feedback"},r.a.createElement("div",null,e.message))})),r.a.createElement("small",{className:"form-text text-muted help"},e.help)))})),r.a.createElement("div",null),r.a.createElement("div",{className:"bottom-section"},r.a.createElement("div",{className:"bottom-buttons"},Ae?r.a.createElement("button",{className:"btn btn-dappnode",disabled:ke.loading,onClick:function(){return Ie.apply(this,arguments)}},"Publish"):r.a.createElement("button",{className:"btn btn-dappnode",disabled:ve.loading,onClick:function(){return Me.apply(this,arguments)}},r.a.createElement("img",{src:Z.a,alt:"",className:"metamaskIcon"})," Connect to Metamask"),ve.result&&r.a.createElement("button",{className:"btn btn-dappnode",disabled:Ee.loading||!0===$,onClick:function(){return Ve.apply(this,arguments)}},"Sign release")),ve.error&&r.a.createElement(S,{error:ve.error}),ve.loading&&r.a.createElement(N,{steps:["Connecting to Metamask"]}),Ee.error&&r.a.createElement(S,{error:Ee.error}),Ee.loading&&r.a.createElement(N,{steps:["Signing release"]}),ke.error&&r.a.createElement(S,{error:ke.error}),ke.loading&&r.a.createElement(N,{steps:["Publishing release transaction"]}),ke.result&&r.a.createElement("div",{className:"feedback-success"},"Published transaction! Tx hash: ",ke.result)))),n?r.a.createElement(r.a.Fragment,null,r.a.createElement(g,null,"Settings"),r.a.createElement(k,null,r.a.createElement("div",{className:"field-name"},"IPFS API URLs"),r.a.createElement("p",{className:"text-muted"},"You can specify multiple URLs, to facilitate propagation of the signed release"),r.a.createElement("textarea",{className:"form-control",placeholder:"https://infura-ipfs.io:5001 \r\nhttp://your-own-ipfs-node:5001",value:f,onChange:function(e){return m(e.target.value)}}))):r.a.createElement("div",{className:"settings-container"},r.a.createElement("span",{className:"show-settings text-muted",onClick:function(){return s(!0)}},"Edit settings")))}n(719),n(720),n(721),n(722),n(723),n(724);i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(fe,null)),document.getElementById("root"))}},[[250,1,2]]]);
//# sourceMappingURL=main.eb99d460.chunk.js.map